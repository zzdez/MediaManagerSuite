<!-- En-tête avec infos et actions globales -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        {# Le titre de la série est maintenant dans l'en-tête de la modale principale, pas besoin de le répéter ici #}
        {# <h4 class="mb-0">{{ series.title }}</h4> #}
        <small class="text-muted">
            Statut Plex:
            {% if series.plex_status == 'ended' %}
                <span class="badge bg-danger">Terminée</span>
            {% elif series.plex_status == 'continuing' %} {# Supposition, à vérifier #}
                <span class="badge bg-success">En cours de diffusion</span>
            {% else %}
                <span class="badge bg-secondary">{{ series.plex_status | capitalize }}</span> {# Affiche le statut brut s'il n'est ni 'ended' ni 'continuing' #}
            {% endif %}
            | Saisons Plex vues: {{ series.viewed_seasons_plex }} / {{ series.total_seasons_plex }}
        </small>
    </div>
    {% if series.sonarr_series_id %} {# Afficher le switch uniquement si la série est trouvée dans Sonarr #}
    <div class="form-check form-switch fs-5">
        <input class="form-check-input series-global-monitor-toggle" type="checkbox" role="switch"
               id="monitor-series-{{ series.ratingKey }}"
               data-sonarr-series-id="{{ series.sonarr_series_id }}"
               {% if series.is_monitored_global %}checked{% endif %}>
        <label class="form-check-label small" for="monitor-series-{{ series.ratingKey }}">Surveiller Série (Sonarr)</label>
    </div>
    {% else %}
    <small class="text-warning">Série non trouvée dans Sonarr pour gestion du monitoring global.</small>
    {% endif %}
</div>

<hr>

<!-- Liste des saisons -->
{% if series.seasons %}
<ul class="list-group list-group-flush">
    {% for season in series.seasons %}
    <li class="list-group-item list-group-item-dark d-flex justify-content-between align-items-center py-2 px-2 mb-1 rounded">
        <div class="flex-grow-1">
            <strong>{{ season.title }}</strong>
            {% if season.total_episodes > 0 %}
                <small class="d-block text-muted">
                    {% if season.viewed_episodes == 0 %}
                        Non commencée
                    {% elif season.viewed_episodes == season.total_episodes %}
                        Terminée
                    {% else %}
                        En cours
                    {% endif %}
                    ({{ season.viewed_episodes }} / {{ season.total_episodes }} ép.)
                </small>
            {% else %}
                 <small class="d-block text-muted">Aucun épisode listé dans Plex.</small>
            {% endif %}
        </div>
        <div class="d-flex align-items-center ms-2">
            {% if series.sonarr_series_id %} {# On a besoin de l'ID de la série Sonarr pour que le toggle saison ait du sens #}
            <div class="form-check form-switch me-3">
                <input class="form-check-input season-monitor-toggle" type="checkbox" role="switch"
                       id="monitor-season-{{ season.ratingKey }}"
                       data-season-id="{{ season.ratingKey }}"
                       {% if season.is_monitored_season %}checked{% endif %}>
                <label class="form-check-label small" for="monitor-season-{{ season.ratingKey }}">Surv.</label>
            </div>
            <button class="btn btn-sm btn-outline-danger delete-season-btn"
                    data-season-id="{{ season.ratingKey }}"
                    data-season-title="{{ season.title }}"
                    title="Supprimer les fichiers de la saison et la dé-monitorer">
                <i class="bi bi-trash"></i>
            </button>
            {% else %}
            <small class="text-warning me-2" title="La série parente n'a pas été trouvée dans Sonarr.">(Actions Sonarr indisponibles)</small>
            {% endif %}
        </div>
    </li>
    {% endfor %}
</ul>
{% else %}
<div class="alert alert-info">Aucune saison trouvée pour cette série dans Plex.</div>
{% endif %}
