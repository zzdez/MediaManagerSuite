<table class="table table-dark table-striped table-hover mt-4 align-middle">
    <thead>
        <tr>
            <th scope="col" style="width: 5%;"><input type="checkbox" class="form-check-input"></th>
            <th scope="col">Titre</th>
            <th scope="col" style="width: 15%;">Bibliothèque</th>
            <th scope="col" style="width: 10%;">Date d'Ajout</th>
            <th scope="col" style="width: 10%;">Statut</th>
            <th scope="col" style="width: 20%;">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td><input type="checkbox" class="form-check-input item-checkbox"></td>
            <td>
                <a href="#" class="text-white item-title-link"
                   data-bs-toggle="modal"
                   data-bs-target="#item-details-modal"
                   data-rating-key="{{ item.ratingKey }}">
                    {{ item.title }}
                </a>
                <small class="d-block text-muted">Année: {{ item.year }}</small>
            </td>
            <td><span class="badge bg-secondary">{{ item.library_name }}</span></td>
            <td>{{ item.addedAt.strftime('%Y-%m-%d') if item.addedAt else 'N/A' }}</td>
            <td class="media-status-cell" data-rating-key="{{ item.ratingKey }}">
                {% if item.isWatched %}
                    <span class="badge bg-success">Vu</span>
                {% else %}
                    <span class="badge bg-warning text-dark">Non Vu</span>
                {% endif %}
            </td>
            <td>
                <button class="btn btn-sm btn-outline-light toggle-watched-btn"
                        title="Basculer Vu/Non Vu"
                        data-rating-key="{{ item.ratingKey }}">
                    <i class="bi bi-eye-fill"></i>
                </button>

                {% if item.type == 'movie' %}
                <button class="btn btn-sm btn-outline-primary archive-movie-btn"
                        title="Archiver le film"
                        data-bs-toggle="modal" data-bs-target="#archiveMovieModal"
                        data-rating-key="{{ item.ratingKey }}"
                        data-title="{{ item.title }}">
                    <i class="bi bi-archive-fill"></i> <span class="d-none d-md-inline">Archiver</span>
                </button>
                {% elif item.type == 'show' %}
                <button class="btn btn-sm btn-outline-primary archive-show-btn"
                        title="Archiver la série"
                        data-bs-toggle="modal" data-bs-target="#archiveShowModal"
                        data-rating-key="{{ item.ratingKey }}"
                        data-title="{{ item.title }}"
                        data-leaf-count="{{ item.leafCount }}"
                        data-viewed-leaf-count="{{ item.viewedLeafCount }}">
                    <i class="bi bi-archive-fill"></i> <span class="d-none d-md-inline">Archiver</span>
                </button>
                <button class="btn btn-sm btn-outline-warning reject-show-btn"
                        title="Rejeter la série (Oublier)"
                        data-bs-toggle="modal" data-bs-target="#rejectShowModal"
                        data-rating-key="{{ item.ratingKey }}"
                        data-title="{{ item.title }}">
                    <i class="bi bi-eraser-fill"></i> <span class="d-none d-md-inline">Rejeter</span>
                </button>
                <a href="{{ url_for('plex_editor.manage_seasons', rating_key=item.ratingKey) }}"
                   class="btn btn-sm btn-outline-info"
                   title="Gérer les saisons">
                    <i class="bi bi-list-task"></i> <span class="d-none d-md-inline">Saisons</span>
                </a>
                {% endif %}

                <button class="btn btn-sm btn-outline-danger delete-item-btn"
                        title="Supprimer définitivement de Plex"
                        data-rating-key="{{ item.ratingKey }}"
                        data-item-title="{{ item.title }}">
                    <i class="bi bi-trash-fill"></i>
                </button>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="6" class="text-center">Aucun média trouvé pour les filtres sélectionnés.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
